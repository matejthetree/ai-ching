<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Ching Coin Casting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
        }
        .coin-container {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .coin {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #d4a017;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: transform 0.2s;
        }
        .coin-container:hover .coin {
            transform: scale(1.1);
        }
        .hexagram-display {
            width: 200px;
            height: 180px; /* 6 lines * (25px total height with margins) */
            margin: 0 auto;
        }
        .hexagram-lines {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column-reverse; /* Bottom-to-top stacking */
            align-items: center;
        }
        .col-12.col-md-6 {
            min-width: 200px;
        }
        .line {
            width: 100%;
            height: 20px;
            margin: 5px 0;
            background-color: rgba(0,0,0,0.7);
        }
        .broken {
            background: repeating-linear-gradient(
                    to right,
                    rgba(0,0,0,0.7) 0px,
                    rgba(0,0,0,0.7) 80px,
                    transparent 80px,
                    transparent 120px
            );
        }
        .changing {
            background-color: rgba(255,0,0,0.7);
        }
        .broken.changing {
            background: repeating-linear-gradient(
                    to right,
                    rgba(255,0,0,0.7) 0px,
                    rgba(255,0,0,0.7) 80px,
                    transparent 80px,
                    transparent 120px
            );
        }
        #copy-text {
            white-space: pre;
            max-width: 300px;
            margin: 0 auto;
            word-wrap: break-word;
        }
        @media (max-width: 576px) {
            .coin {
                width: 60px;
                height: 60px;
                font-size: 18px;
            }
            .hexagram-display {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="text-center">I Ching Coin Casting</h1>
    <div id="coin-container" class="coin-container">
        <div class="coin" onclick="castCoin()">Cast</div>
        <div class="coin" onclick="castCoin()">Cast</div>
        <div class="coin" onclick="castCoin()">Cast</div>
    </div>
    <div id="results" class="mt-4">
        <div class="row justify-content-center">
            <div class="col-12 col-md-6">
                <h3 class="text-center">Original Hexagram</h3>
                <div class="hexagram-display">
                    <div id="original-hex" class="hexagram-lines"></div>
                </div>
                <div id="original-number" class="text-center mt-2"></div>
            </div>
            <div class="col-12 col-md-6" id="transformed-container" style="visibility: hidden;">
                <h3 class="text-center">Transformed Hexagram</h3>
                <div class="hexagram-display">
                    <div id="transformed-hex" class="hexagram-lines"></div>
                </div>
                <div id="transformed-number" class="text-center mt-2"></div>
            </div>
        </div>
    </div>
    <div id="copy-text" class="mt-4 p-3 bg-light border text-center"></div>
    <div class="text-center d-flex justify-content-center gap-2">
        <button id="copy-button" class="btn btn-primary mt-2" style="display: none;" onclick="copyResult()">Copy Result</button>
        <button id="cast-again" class="btn btn-secondary mt-2" style="display: none;" onclick="resetCasting()">Cast Again</button>
    </div>
</div>

<script>
    let casts = [];
    const hexagrams = {
        '111111': { number: 1, name: 'Ch\'ien', englishName: 'The Creative' }, 
        '000000': { number: 2, name: 'K\'un', englishName: 'The Receptive' },
        '100010': { number: 3, name: 'Chun', englishName: 'Difficulty at the Beginning' }, 
        '000010': { number: 4, name: 'Mêng', englishName: 'Youthful Folly' },
        '111010': { number: 5, name: 'Hsü', englishName: 'Waiting' }, 
        '010111': { number: 6, name: 'Sung', englishName: 'Conflict' },
        '010000': { number: 7, name: 'Shih', englishName: 'The Army' }, 
        '000010': { number: 8, name: 'Pi', englishName: 'Holding Together' },
        '111011': { number: 9, name: 'Hsiao Ch\'u', englishName: 'The Taming Power of the Small' }, 
        '110111': { number: 10, name: 'Li', englishName: 'Treading' },
        '111000': { number: 11, name: 'T\'ai', englishName: 'Peace' }, 
        '000111': { number: 12, name: 'P\'i', englishName: 'Standstill' },
        '101111': { number: 13, name: 'T\'ung Jên', englishName: 'Fellowship with Men' }, 
        '111101': { number: 14, name: 'Ta Yu', englishName: 'Possession in Great Measure' },
        '001000': { number: 15, name: 'Ch\'ien', englishName: 'Modesty' }, 
        '000100': { number: 16, name: 'Yü', englishName: 'Enthusiasm' },
        '110010': { number: 17, name: 'Sui', englishName: 'Following' }, 
        '001011': { number: 18, name: 'Ku', englishName: 'Work on What Has Been Spoiled' },
        '110000': { number: 19, name: 'Lin', englishName: 'Approach' }, 
        '000011': { number: 20, name: 'Kuan', englishName: 'Contemplation' },
        '100010': { number: 21, name: 'Shih Ho', englishName: 'Biting Through' }, 
        '010001': { number: 22, name: 'Pi', englishName: 'Grace' },
        '000001': { number: 23, name: 'Po', englishName: 'Splitting Apart' }, 
        '100000': { number: 24, name: 'Fu', englishName: 'Return' },
        '100111': { number: 25, name: 'Wu Wang', englishName: 'Innocence' }, 
        '111001': { number: 26, name: 'Ta Ch\'u', englishName: 'The Taming Power of the Great' },
        '100001': { number: 27, name: 'I', englishName: 'Corners of the Mouth' }, 
        '011110': { number: 28, name: 'Ta Kuo', englishName: 'Preponderance of the Great' },
        '010110': { number: 29, name: 'K\'an', englishName: 'The Abysmal' }, 
        '101101': { number: 30, name: 'Li', englishName: 'The Clinging' },
        '001110': { number: 31, name: 'Hsien', englishName: 'Influence' }, 
        '011100': { number: 32, name: 'Hêng', englishName: 'Duration' },
        '111100': { number: 33, name: 'Tun', englishName: 'Retreat' }, 
        '001111': { number: 34, name: 'Ta Chuang', englishName: 'The Power of the Great' },
        '000101': { number: 35, name: 'Chin', englishName: 'Progress' }, 
        '101000': { number: 36, name: 'Ming I', englishName: 'Darkening of the Light' },
        '101011': { number: 37, name: 'Chia Jên', englishName: 'The Family' }, 
        '110101': { number: 38, name: 'K\'uei', englishName: 'Opposition' },
        '001010': { number: 39, name: 'Chien', englishName: 'Obstruction' }, 
        '010100': { number: 40, name: 'Hsieh', englishName: 'Deliverance' },
        '100011': { number: 41, name: 'Sun', englishName: 'Decrease' }, 
        '110001': { number: 42, name: 'I', englishName: 'Increase' },
        '111110': { number: 43, name: 'Kuai', englishName: 'Break-through' }, 
        '011111': { number: 44, name: 'Kou', englishName: 'Coming to Meet' },
        '000110': { number: 45, name: 'Ts\'ui', englishName: 'Gathering Together' }, 
        '011000': { number: 46, name: 'Shêng', englishName: 'Pushing Upward' },
        '011010': { number: 47, name: 'K\'un', englishName: 'Oppression' }, 
        '010110': { number: 48, name: 'Ching', englishName: 'The Well' },
        '101110': { number: 49, name: 'Ko', englishName: 'Revolution' }, 
        '011101': { number: 50, name: 'Ting', englishName: 'The Cauldron' },
        '100100': { number: 51, name: 'Chên', englishName: 'The Arousing' }, 
        '001001': { number: 52, name: 'Kên', englishName: 'Keeping Still' },
        '001011': { number: 53, name: 'Chien', englishName: 'Development' }, 
        '110100': { number: 54, name: 'Kuei Mei', englishName: 'The Marrying Maiden' },
        '101100': { number: 55, name: 'Fêng', englishName: 'Abundance' }, 
        '001101': { number: 56, name: 'Lü', englishName: 'The Wanderer' },
        '011011': { number: 57, name: 'Sun', englishName: 'The Gentle' }, 
        '110110': { number: 58, name: 'Tui', englishName: 'The Joyous' },
        '010011': { number: 59, name: 'Huan', englishName: 'Dispersion' }, 
        '001101': { number: 60, name: 'Chieh', englishName: 'Limitation' },
        '110011': { number: 61, name: 'Chung Fu', englishName: 'Inner Truth' }, 
        '001100': { number: 62, name: 'Hsiao Kuo', englishName: 'Preponderance of the Small' },
        '101010': { number: 63, name: 'Chi Chi', englishName: 'After Completion' }, 
        '010101': { number: 64, name: 'Wei Chi', englishName: 'Before Completion' }
    };

    function castCoin() {
        if (casts.length >= 6) return;
        const result = Math.floor(Math.random() * 2) + Math.floor(Math.random() * 2) + Math.floor(Math.random() * 2) + 6;
        casts.push(result);
        updateDisplay();
    }

    function getTransformedLines(casts) {
        return casts.map(c => {
            if (c === 6) return 7;
            if (c === 9) return 8;
            return c;
        });
    }

    function generateLinesHTML(lines, changingIndices = []) {
        return lines.map((line, index) => {
            const isBroken = line === 6 || line === 8;
            const isChanging = changingIndices.includes(index);
            let className = 'line';
            if (isBroken) className += ' broken';
            if (isChanging) className += ' changing';
            return `<div class="${className}"></div>`;
        }).join('');
    }

    function updateDisplay() {
        const originalHex = document.getElementById('original-hex');
        originalHex.innerHTML = generateLinesHTML(casts, casts.map((c, i) => (c === 6 || c === 9) ? i : -1).filter(x => x >= 0));
        
        // Always generate transformed hexagram but keep hidden until complete
        const transformedLines = getTransformedLines(casts);
        document.getElementById('transformed-hex').innerHTML = generateLinesHTML(transformedLines);

        if (casts.length === 6) {

            const originalBinary = casts.map(c => (c === 6 || c === 8) ? '0' : '1').join('');
            const transformedBinary = transformedLines.map(c => (c === 8) ? '0' : '1').join('');
            const hexagram = getHexagramNumber(originalBinary);
            const transformedHex = getHexagramNumber(transformedBinary);
            document.getElementById('original-number').textContent = `${hexagram.number}. ${hexagram.name} (${hexagram.englishName})`;
            document.getElementById('transformed-number').textContent = `${transformedHex.number}. ${transformedHex.name} (${transformedHex.englishName})`;

            const changingLines = casts.map((c, i) => (c === 6 || c === 9) ? i + 1 : null).filter(x => x !== null);
            document.getElementById('copy-text').textContent = `Original: ${hexagram.number}. ${hexagram.englishName}\nTransformed: ${transformedHex.number}. ${transformedHex.englishName}\nChanging Lines: ${changingLines.length > 0 ? changingLines.join(',') : 'None'}`;

            document.getElementById('transformed-container').style.visibility = 'visible';
            document.getElementById('copy-button').style.display = 'inline-block';
            document.getElementById('cast-again').style.display = 'inline-block';
        } else {
            document.getElementById('transformed-container').style.visibility = 'hidden';
            document.getElementById('copy-button').style.display = 'none';
            document.getElementById('cast-again').style.display = 'none';
            document.getElementById('coin-container').style.display = 'flex';
        }
    }

    function getHexagramNumber(binary) {
        const hexagram = hexagrams[binary];
        return hexagram ? hexagram : { number: '??', name: 'Unknown' };
    }

    function copyResult() {
        const text = document.getElementById('copy-text').textContent;
        navigator.clipboard.writeText(text);
        alert('Result copied to clipboard!');
    }

    function resetCasting() {
        casts = [];
        document.getElementById('original-number').textContent = '';
        document.getElementById('transformed-number').textContent = '';
        document.getElementById('copy-text').textContent = '';
        document.getElementById('transformed-container').style.visibility = 'hidden';
        updateDisplay();
    }
</script>
</body>
</html>
